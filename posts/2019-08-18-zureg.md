---
title: 'The ZuriHac registration system'
description: 'How and why we wrote our own tools from scratch'
tags: 'haskell'
---

# Introduction

I am one of the main organizers of [ZuriHac], and last year, we wrote our own
registration system for the conference in Haskell.  This blogpost explains why
we decided to go this route, and we go into its design a bit as a case study.  I

I hope that the second part is especially useful to less experienced Haskellers,
since it is a nice example of small but useful standalone application.  In fact,
this was more or less an explicit purpose of the project: I worked on this
together with [Charles Till] to mentor him a bit in day-to-day practical
Haskell.

In theory, it should also be able to reuse this system for other conferences --
not too much of it ZuriHac specific, and it's all open source.

# Why?

Before 2019; ZuriHac registration worked purely based on Google tools and manual
labor:

 -  Google Forms for the registration form
 -  Google Sheets to manage the registrants, waitlist, T-Shirt numbers, ...
 -  Google Groups to contact registrants

Apart from the fact that the manual labor done by yours truly wasn't scaling
above roughly 300 people, there were a number of practical issues with these
tools.  The biggest issue was managing the waiting list and cancellations.

ZuriHac is a free conference, which means that the barrier to signing up for it
is (intentionally) extremely low.  Unfortunately, this will always result in a
significant amount of people who sign up for the event, but do not actually
attend.  We try compensating for that by overbooking and offering cancellations;
but sometimes it turns out to be hard to get people to cancel as well --
especially if it's hard to reach them -- Google Groups is not great for the
purpose we're using it for.

So one of the goals for the new registration system (in addition to reducing
work on our side) was to be able to track participant numbers better.  We wanted
to work a downloadable ticket; or with an explicit confirmation that you're
attending the event.

I looked into a few options (eventbrite, eventlama, and others...) but neither
of them ticked all the boxes: aside from being free (since we have limited
budget), the privacy of our attendees and some sort of JSON or CSV export option
were very important to us.

So, I decided to solve this problem the same the way I usually solve problems:
write some Haskell code.

# How?

The ZuriHac Registration system ([zureg]) is a "serverless" application that
runs on AWS.  It was designed to fit almost entirely in the free tier of AWS;
which is why I e.g. picked DynamoDB over a database that's actually nice to use.
We'll use Brendan Hay's excellent and extensive [amazonka] libraries to talk to
AWS.

There's two big parts to the application: a fat lambda function that provides a
number of different endpoints, and a bunch of command line utilities that talk
to the different services directly.

        Participants  <------------>  API Gateway <----> Lambda

                                                            ^
                                                            |
                                                            |
                                                            |
                                                            v

        CLI Tools     <------------------------>      DynamoDB & SES

However, these are both part of one monolithic codebase which makes it very easy
to share code and ensure all behaviour is consistent -- one big "library" and
multiple lightweight "executables" is how I like to design applications.

## The database

Our data model isn't too complex.  We're using an event sourcing approach: this
means that our source of truth is really an append-only series of events rather
than a traditional row in a database that we update.  These events are stored as
plain JSON, and we can define them in pure Haskell:

    https://github.com/zfoh/zureg/blob/master/lib/Zureg/Model.hs

And then we just have a few handwritten functions in the database module:

    https://github.com/zfoh/zureg/blob/master/lib/Zureg/Database.hs

This gives us a few things for free; most importantly if something goes wrong we
can go in and check what events led the user to get into this invalid state.


